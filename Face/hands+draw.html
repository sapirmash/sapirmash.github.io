<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.6.1629159505/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="anonymous"></script>

    <!-- The main handpose library -->
  <script src="https://unpkg.com/@tensorflow-models/handpose@0.0.7/dist/handpose.js"></script>

  <script src="fingerpose.js" type="text/javascript"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400&family=Open+Sans:wght@600&family=Work+Sans:wght@500&display=swap" rel="stylesheet">
  <meta charset="utf-8" />

</head>
  <body>
    <div id="hand_pointer"></div>

    <div class="nav">
    <a class="name">Back to Kindergarten</a>
    <a class="target" id="info"> 
      <img class="close_img" style="display:none; width: 12px; padding-right: 4px; padding-top: 1px; stroke-width:0.5px;" src="close.svg"/> Info</a>
    </div>

    <span id="on_start">
      Use your <img style="width: 20px; height: 23px; vertical-align:middle; padding-left: 2px;
    padding-bottom: 5px;" src="point.png"> finger to draw and the 
    <img style="width: 20px; height: 23px; vertical-align:middle; padding-left: 2px;
    padding-bottom: 5px;" src="five.png"> gesture to stop drawing.
    </span>
    <!-- <span class="date"></span> -->
    
    <video class="input_video"></video>
    
    <div id="canvascontainer"></div>

    <div class="actions">
    <span class="buttons_list">
    <img class="close_gallery" style="display:none; width: 12px; padding-right: -2px; padding-top: 1px; stroke-width:0.5px;" src="close.svg"/>
    <button class="close_me" id="gallery">Gallery</button>
    </span>

    <span class="buttons_list"> 
    <img class="close_upload" style="display:none; width: 12px; padding-right: -2px; padding-top: 1px; stroke-width:0.5px;" src="close.svg"/>  
    <button id="uploadButton">Upload</button>
    </span>

    <span class="buttons_list">
     <span class="colors_list">
      <button class="colors_button orange" id="btn"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button yellow" id="btn_01"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button red" id="btn_02"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button green" id="btn_03"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button purple" id="btn_04"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button blue" id="btn_05"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button brown" id="btn_06"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button black" id="btn_07"></button>
    </span> 
    </span>

    <span class="buttons_list">
    <button id="downloadButton">Download</button>
    </span>
    <span class="buttons_list">
    <button id="clearButton">New</button>
    </span>


    </div>

   <!--  <div class="colors">
    <span class="colors_list">
      <button class="colors_button orange" id="btn"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button yellow" id="btn_01"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button red" id="btn_02"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button green" id="btn_03"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button purple" id="btn_04"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button blue" id="btn_05"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button brown" id="btn_06"></button>
    </span>
    <span class="colors_list">
      <button class="colors_button black" id="btn_07"></button>
    </span>
    </div> -->


    <div class="gallery-modal">
     <div class="drawinglist"></div> 
    <!-- <a href='#' class="close"><img style="width: 17px; stroke-width:0.5px;" src="close.svg"></a> -->
    </div>

    <div class="info-modal">
      <div class="info-text">
        Back to Kindergarten is a machine learning - based drawing tool, where you can simply draw with your hands. Enjoy the opportunity to be less precise and controlled by freely moving your hand in space.
        <br>
        <br>
        <br>
        Technologies
        <br>
        <a class="info_links" href="https://google.github.io/mediapipe/solutions/hands.html">Media Pipe</a> + <a class="info_links" href="https://p5js.org/">P5js</a>
        <br></br>
        Code & Design
        <br>
        <a class="info_links" href="https://www.instagram.com/sapir__m/">Sapir Mashiach</a>  
      </div>
     <!--  <a href='#' class="close"><img style="width: 17px;" src="close.svg"></a> -->
    </div>

    <div class="save-overlay">    
          <div class="content-overlay">
            <p class="text">
              Share your drawing with everyone! Please be nice, and respect this space.
            </p>
            <div id="preview"> 
            </div>
            <div class="form">
              <input type="text" id="name_input" name="fname">
              <button id="Submit">Submit</button>
           </div>   
          </div>
        <!-- <a href='#' class="save-overlay__close">
           <img style="width: 17px;" src="close.svg"></a> -->
        </div>

    <div id="frame">
      <p class="desktop_view">Sorry, but Back to Kindergarten needs more screen space. Please visit on something larger for the full experience.</p>
    </div>

  </body>
</html>

<style type="text/css">
 html, body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    overflow-x: hidden;
  }
  
/*  @font-face {
  font-family: CommonSans-Regular;
  src: url(CommonSans-Regular 2.otf);
}*/

figcaption{
  font-size: 15px;
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  padding-top: 10px;
  padding-bottom: 5px;
  display: none;
}

.info_links{
  text-decoration: none;
  color: #000;
  box-shadow: 0 0.06em 0 0.0001em #000;
}

.nav{
  border-bottom: 0.9px solid;
  background-color: white;
  display: flex;
  position: fixed;
  z-index: 1;
  width: calc(100vw - (100vw - 100%) + 1px);
  height: 36px;
  transform: translate(-1px, -1px);
}

#hand_pointer{
  width: 8px;
  height: 8px;
  border-radius: 20px;
  position: absolute;
  z-index: 999999;
  display: none;
}


#preview{
  margin-right: 0;
  border: 0.9px solid #000;
  margin-top: 45px;
  margin-bottom: 14px;
  vertical-align: middle;
  margin: 0.5rem;
  /*width: 852px;*/
  width: 800px;
  height: auto;
}

.preview_img{
  border: 0.9px solid #000;
  display: none;
  max-width: 100%;
  height: auto;
}

.drawinglist::-webkit-scrollbar {
    display: none;
}

.drawinglist{
  margin: 0 auto;
  display: grid;
  padding: 0.5rem 0.5rem 0rem 0.5rem;
  overflow-y: scroll;
  /*max-height: 51.5vw;*/
  max-height: 99%;
  /*margin-top: 45px;*/
  overflow-x: hidden;
}

.active_gallery{
}

.no_pointer{
  display: none;
}

.gallery-content{
  display: none;
}

.li-draw {
    padding: 0.7rem;
}

@media (min-width: 900px) {
  .drawinglist { grid-template-columns: repeat(4, 1fr); }
}

@media (max-width: 1350px) {
  .drawinglist { 
    grid-template-columns: repeat(3, 1fr);
    margin: 0 auto;
    display: grid;
    overflow-y: scroll;
    max-height: 99%;
    overflow-x: hidden;
   }

   .preview_img{
  border: 0.9px solid #000;
  display: none;
  max-width: 100%;
  height: auto;
}
}


.gallery-modal{
  transform:translateX(-50%) translateY(-50%) scale(1) translateZ(0px);
  width: 100vw;
  height: 92.4vh;
  left: 50%;
  top: 49.9%;
  background: white;
  opacity: 0.98;
  /*border: 0.9px solid #000;*/
  position: fixed;
  display: none;
}

.save-overlay {
  font-family: 'Inter', sans-serif;
  transform:translateX(-50%) translateY(-50%) scale(1) translateZ(0px);
  /*max-width: 100vw;*/

  width: 100vw;
  height: 92.4%;
  left: 50%;
  top: 49.9%;
  background: white;
  opacity: 0.98;
  /*border: 0.9px solid #000;*/
  position: fixed;
  display: none;
}

.content-overlay{
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  max-width: 820px;
  position: relative;
  top: 50%;
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
  grid-template-columns: repeat(1, 1fr);
}

.info-modal{
  transform:translateX(-50%) translateY(-50%) scale(1) translateZ(0px);
  /*max-width: 560px;*/
  width: 100vw;
  height: 92.2%;
  left: 50%;
  top: 50%;
  background: white;
  opacity: 0.98;
  /*border: 0.9px solid #382826;*/
  position: fixed;
  display: none;
}

.info-text{
  display: grid;
  /*padding: 3rem 6.5rem 1.5rem 1.5rem;*/
  font-size: 17px;
  line-height: 24px;
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  display: none;
  text-align: center;
  margin: 0 auto;
  display: flex;
  justify-content: center;
  align-items: center;
  max-width: 560px;
  position: relative;
  top: 50%;
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
  grid-template-columns: repeat(1, 1fr);
}

.modal{
  height: 100%;
  width: 100%;
  z-index: 3000;
  top: 50%;
  left: 50%;
  -webkit-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  display: none;
  position: fixed;
}



.active_overlay{
  display: block;
}

/*.active_gallery::after {
  content: "";
  flex: auto;
  align-content: flex-start;
}*/
.save-overlay.open {
  -webkit-transform: translate(-50%, 50%);
  transform: translate(-50%, 50%);
  bottom: 53vh;
  z-index: 4000;
}

.save-overlay__close {
  font-size: 17px;
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  position: absolute;
  right: 28px;
  top: 20px;
  color: black;
  cursor: pointer;
  text-decoration: none;
  z-index: 4000;
  /*right: calc(100% - 93%);*/
}



#info{
  font-size: 15px;
  font-family:'Inter', sans-serif;
  align-items: center;
  position: relative;
  z-index: 1;
  height: 100%;
  width: 50%;
  justify-content: center;
  /*color: #000000;*/
  line-height: 1.96;
  display: flex;
  cursor: pointer;
}

.selected{
  /*display: block;*/
  /*color: white;*/
  /*background-color: #F7F6F5;*/
  /*background-color: #000;*/
/*  background-image: url("close.svg");
  background-repeat: no-repeat;
  width: 12px;
  stroke-width:0.5px;*/
  /*<img style="width: 12px; stroke-width:0.5px;" src="close.svg"> */
}

#info:hover {
  cursor: pointer !important;
 /* background-color: #000;
  color: white;*/
}


#gallery{
/*  font-size: 17px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  color: black;
  text-decoration: none;
  padding-right: 10px;
  cursor: pointer;*/
  /*margin: 0 10px 0px;*/
  /*padding: 8px 16px 8px 16px;*/
  border: none;
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  background-color: white;
  cursor: pointer;
}


.actions{
   /* display: flex;
    align-items: center;
    justify-content: center;
    width: 50%;
    padding: 0;
    position: fixed;
    bottom: 0;
    right: 50%;
    margin: 0 auto;
    transform: translate(50%, 0);*/

    display: flex;
    /*align-items: center;*/
    justify-content: space-between;
    width: 100%;
    /*padding:5px;*/
    height: 36px;
    position: fixed;
    bottom: 0;
    border-top: 0.9px solid;
    background: white;
}

.buttons_list{
  display: flex;
  justify-content: center;
  align-items: center;
  /*flex: 0 1 auto; /* Default */*/
  list-style-type: none;
  /*margin-bottom: 5px;*/
  flex-grow: 1;
  border-right: 0.9px solid;
}

#on_start{
  font-size: 17px;
  font-family: 'Inter', sans-serif;
  font-weight: 400;
  position: absolute;
  width: 50%;
  top: 50%;
  transform: translate(50%, 50%);
  text-align: center
}

.colors{
    display: flex;
    align-items: center; /* Default */
    justify-content: center;
    /*width: 20s%;*/
    margin-bottom: 50px;
    padding:5px;
    position: fixed;
    bottom: 0;
    right: 50%;
    border: 1px solid #000;
    transform: translate(50%, 0);
}

.colors_list{
  display: flex;
  align-items: center;
  flex: 0 1 auto; /* Default */
  list-style-type: none;
  /*margin: 0px 0px 0px 10px;*/

}

#btn{
  padding: 12px;
  cursor: pointer;
  margin-right: 12px;
  background-color: #F26945;
}

.orange{
  border: 1px solid #F26945;
}


#btn_01{
  padding: 12px;
  cursor: pointer;
  margin-left: 0;
  background-color: #FAE80B;
  margin-right: 12px;
}

.yellow{
  border: 1px solid #FAE80B;
}


#btn_02{
  padding: 12px;
  cursor: pointer;
  background-color:#CF2133;
  margin-right: 12px;
}

.red{
  border: 1px solid #CF2133;
}


#btn_03{
  padding: 12px;
  cursor: pointer;
  background-color:#0E8142;
  margin-right: 12px;
}

.green{
   border: 1px solid #0E8142;
}


#btn_04{
  padding: 12px;
  cursor: pointer;
  background-color:#4D3292;
  margin-right: 12px;
}

.purple{
  border: 1px solid #4D3292;
}


#btn_05{
  padding: 12px;
  cursor: pointer;
  background-color:#2D63AF;
  margin-right: 12px;
}

.blue{
  border: 1px solid #2D63AF;
}

#btn_06{
  padding: 12px;
  cursor: pointer;
  background-color:#81592F;
  margin-right: 12px;
}

.brown{
  border: 1px solid #81592F;
}

#btn_07{
  padding: 12px;
  cursor: pointer;
  background-color:#000000;
}

.black{
  border: 1px solid #000000;
}

.color_selected{
   border: 1px solid #000;
}

#uploadButton{
  /*padding: 8px 16px 8px 16px;*/
  border: none;
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  background-color: white;
  cursor: pointer;
}


#downloadButton{
  border: none;
  background-color: white;
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  cursor: pointer;
}

#Submit{
  border: 0.9px solid #000;
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  padding: 1px 10px;
  flex-grow: 1;
  max-width: 300px;
  position: relative;
  background-color: white;
  cursor: pointer;
}


input{
  height: 32px;
  position: relative;
  min-width: 30px;
  padding: 1px 5px;
  background-color: white;
  border: 0.9px solid #000;
  flex-grow: 1;
  fill: black;
}

:focus {
  outline: none;

}

.form{
  display: flex;
  column-gap: 8px;
  position: relative;
  padding: 0.1rem 0.5rem 0rem 0.5rem;
  /*transform: translate(0%, 170%);*/
}



.text{
  font-size: 17px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  text-align: center;
  /*position: absolute;*/
  /*left: 24px;*/
  margin: 0rem 0.5rem 1rem 0.5rem;
  /*top: 10px;*/
}

#clearButton{
  border: none;
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
  background-color: white;
  cursor: pointer;
}

.name{
  /*margin: 0;*/
  font-size: 15px;
  font-family:'Inter', sans-serif;
  font-weight: 400;

   display: flex;
  position: relative;
    z-index: 1;
    height: 100%;
    width: 50%;
    background: #fff;
   border-right: 0.9px solid;
    justify-content: center;
    cursor: pointer;
    color: #000000;
    line-height: 1.96;
    text-decoration: none;
    align-items: center;
}

.name a{
    text-decoration: none;
    color: black;
}


.name_input{
  font-size: 17px;
  font-family:'Inter', sans-serif;
  font-weight: 400;
}

.date{
  padding: 46px;
  margin-left: 120px;
  font-size: 17px;
  position: fixed;
 font-family:'Inter', sans-serif;
  font-weight: 400;
}

  canvas {
    display: block;
  }
  
  video{
    position: fixed;
    bottom: 35px;
    left: 0;
    /*display: none;*/
    -webkit-filter: grayscale(100%); 
    filter: grayscale(100%);
  }

  #frame{
    display: none;
  }
  @media only screen and (max-width: 900px){
  
    video{
      display: none;
    }

  .actions{
      display: none;
    }

  .name{
      display: none;
    }

  #canvascontainer{
      display: none;
    }
   #gallery{
     display: none;
   } 

   #frame {
    display: block;
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 999;
    background: #fff;
} 

.desktop_view {
    font-size: 20px;
    width: 88vw;
    margin: 0 auto;
    font-family: 'Inter', sans-serif;
    position: fixed;
    top: 50%;
    left: 50%;
    -webkit-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);
    text-align: center;
 }   
  
  #on_start{
    display: none;
  } 

  #hand_pointer{
    display: none;
  }

}
</style>

<script type="text/javascript">

if ($(window).width() > 900) {
  

class FingerPoseEstimator {

  constructor(options) {

    this.options = {...{

      // curl estimation
      HALF_CURL_START_LIMIT: 60.0,
      NO_CURL_START_LIMIT: 130.0,

      // direction estimation
      DISTANCE_VOTE_POWER: 1.1,
      SINGLE_ANGLE_VOTE_POWER: 0.9,
      TOTAL_ANGLE_VOTE_POWER: 1.6
    }, ...options};
  }

  estimate(landmarks) {

    // step 1: calculate slopes

    let slopesXY = [];
    let slopesYZ = [];

    for(let finger of fp.Finger.all) {

      let points = fp.Finger.getPoints(finger);
      let slopeAtXY = [];
      let slopeAtYZ = [];

      for(let point of points) {

        let point1 = landmarks[point[0]];
        let point2 = landmarks[point[1]];

        // calculate single slope
        let slopes = this.getSlopes(point1, point2);
        let slopeXY = slopes[0];
        let slopeYZ = slopes[1];
        slopeAtXY.push(slopeXY);
        slopeAtYZ.push(slopeYZ);
      }

      slopesXY.push(slopeAtXY);
      slopesYZ.push(slopeAtYZ);
    }

    // step 2: calculate orientations

    let fingerCurls = [];
    let fingerDirections = [];

    for(let finger of fp.Finger.all) {

      // start finger predictions from palm - except for thumb
      let pointIndexAt = (finger == fp.Finger.Thumb) ? 1 : 0;

      let fingerPointsAt = fp.Finger.getPoints(finger);
      let startPoint = landmarks[fingerPointsAt[pointIndexAt][0]];
      let midPoint = landmarks[fingerPointsAt[pointIndexAt + 1][1]];
      let endPoint = landmarks[fingerPointsAt[3][1]];

      // check if finger is curled
      let fingerCurled = this.estimateFingerCurl(
        startPoint, midPoint, endPoint
      );

      let fingerPosition = this.calculateFingerDirection(
        startPoint, midPoint, endPoint,
        slopesXY[finger].slice(pointIndexAt)
      );

      fingerCurls[finger] = fingerCurled;
      fingerDirections[finger] = fingerPosition;
    }

    return { curls: fingerCurls, directions: fingerDirections }
  }

  // point1, point2 are 2d or 3d point arrays (xy[z])
  // returns either a single scalar (2d) or array of two slopes (3d)
  getSlopes(point1, point2) {

    let slopeXY = this.calculateSlope(point1[0], point1[1], point2[0], point2[1]);
    if(point1.length == 2) {
      return slopeXY;
    }

    let slopeYZ = this.calculateSlope(point1[1], point1[2], point2[1], point2[2])
    return [slopeXY, slopeYZ];
  }

  angleOrientationAt(angle, weightageAt = 1.0) {

    let isVertical = 0;
    let isDiagonal = 0;
    let isHorizontal = 0;

    if(angle >= 75.0 && angle <= 105.0) {
      isVertical = 1 * weightageAt;
    }
    else if(angle >= 25.0 && angle <= 155.0) {
      isDiagonal = 1 * weightageAt;
    }
    else {
      isHorizontal = 1 * weightageAt;
    }

    return [isVertical, isDiagonal, isHorizontal];
  }

  estimateFingerCurl(startPoint, midPoint, endPoint) {

    let start_mid_x_dist = startPoint[0] - midPoint[0];
    let start_end_x_dist = startPoint[0] - endPoint[0];
    let mid_end_x_dist = midPoint[0] - endPoint[0];
    
    let start_mid_y_dist = startPoint[1] - midPoint[1];
    let start_end_y_dist = startPoint[1] - endPoint[1];
    let mid_end_y_dist = midPoint[1] - endPoint[1];
  
    let start_mid_z_dist = startPoint[2] - midPoint[2];
    let start_end_z_dist = startPoint[2] - endPoint[2];
    let mid_end_z_dist = midPoint[2] - endPoint[2];
    
    let start_mid_dist = Math.sqrt(
      start_mid_x_dist * start_mid_x_dist +
      start_mid_y_dist * start_mid_y_dist +
      start_mid_z_dist * start_mid_z_dist
    );
    let start_end_dist = Math.sqrt(
      start_end_x_dist * start_end_x_dist +
      start_end_y_dist * start_end_y_dist +
      start_end_z_dist * start_end_z_dist
    );
    let mid_end_dist = Math.sqrt(
      mid_end_x_dist * mid_end_x_dist +
      mid_end_y_dist * mid_end_y_dist +
      mid_end_z_dist * mid_end_z_dist
    );

    let cos_in = (
      mid_end_dist * mid_end_dist +
      start_mid_dist * start_mid_dist -
      start_end_dist *start_end_dist
    ) / (2 * mid_end_dist * start_mid_dist);

    if(cos_in > 1.0) {
      cos_in = 1.0;
    }
    else if(cos_in < -1.0) {
      cos_in = -1.0;
    }

    let angleOfCurve = Math.acos(cos_in);

    angleOfCurve = (57.2958 * angleOfCurve) % 180;

    let fingerCurl;
    if(angleOfCurve > this.options.NO_CURL_START_LIMIT) {
      fingerCurl = fp.FingerCurl.NoCurl;
    }
    else if(angleOfCurve > this.options.HALF_CURL_START_LIMIT) {
      fingerCurl = fp.FingerCurl.HalfCurl;
    }
    else {
      fingerCurl = fp.FingerCurl.FullCurl;
    }


    return fingerCurl;
  }

  estimateHorizontalDirection(start_end_x_dist, start_mid_x_dist, mid_end_x_dist, max_dist_x) {

    let estimatedDirection;
    if(max_dist_x == Math.abs(start_end_x_dist)) {
      if(start_end_x_dist > 0) {
        estimatedDirection = fp.FingerDirection.HorizontalLeft;
      } else {
        estimatedDirection = fp.FingerDirection.HorizontalRight;
      }
    }
    else if(max_dist_x == Math.abs(start_mid_x_dist)) {
      if(start_mid_x_dist > 0) {
        estimatedDirection = fp.FingerDirection.HorizontalLeft;
      } else {
        estimatedDirection = fp.FingerDirection.HorizontalRight;
      }
    }
    else {
      if(mid_end_x_dist > 0) {
        estimatedDirection = fp.FingerDirection.HorizontalLeft;
      } else {
        estimatedDirection = fp.FingerDirection.HorizontalRight;
      }
    }

    return estimatedDirection;
  }

  estimateVerticalDirection(start_end_y_dist, start_mid_y_dist, mid_end_y_dist, max_dist_y) {

    let estimatedDirection;
    if(max_dist_y == Math.abs(start_end_y_dist)) {
      if(start_end_y_dist < 0) {
        estimatedDirection = fp.FingerDirection.VerticalDown;
      } else {
        estimatedDirection = fp.FingerDirection.VerticalUp;
      }
    }
    else if(max_dist_y == Math.abs(start_mid_y_dist)) {
      if(start_mid_y_dist < 0) {
        estimatedDirection = fp.FingerDirection.VerticalDown;
      } else {
        estimatedDirection = fp.FingerDirection.VerticalUp;
      }
    }
    else {
      if(mid_end_y_dist < 0) {
        estimatedDirection = fp.FingerDirection.VerticalDown;
      } else {
        estimatedDirection = fp.FingerDirection.VerticalUp;
      }
    }

    return estimatedDirection;
  }

  estimateDiagonalDirection(
    start_end_y_dist, start_mid_y_dist, mid_end_y_dist, max_dist_y,
    start_end_x_dist, start_mid_x_dist, mid_end_x_dist, max_dist_x
  ) {

    let estimatedDirection;
    let reqd_vertical_direction = this.estimateVerticalDirection(
      start_end_y_dist, start_mid_y_dist, mid_end_y_dist, max_dist_y
    );
    let reqd_horizontal_direction = this.estimateHorizontalDirection(
      start_end_x_dist, start_mid_x_dist, mid_end_x_dist, max_dist_x
    );
    
    if(reqd_vertical_direction == fp.FingerDirection.VerticalUp) {
      if(reqd_horizontal_direction == fp.FingerDirection.HorizontalLeft) {
        estimatedDirection = fp.FingerDirection.DiagonalUpLeft;
      } else {
        estimatedDirection = fp.FingerDirection.DiagonalUpRight;
      }
    }
    else {
      if(reqd_horizontal_direction == fp.FingerDirection.HorizontalLeft) {
        estimatedDirection = fp.FingerDirection.DiagonalDownLeft;
      } else {
        estimatedDirection = fp.FingerDirection.DiagonalDownRight;
      }
    }

    return estimatedDirection;
  }

  calculateFingerDirection(startPoint, midPoint, endPoint, fingerSlopes) {

    let start_mid_x_dist = startPoint[0] - midPoint[0];
    let start_end_x_dist = startPoint[0] - endPoint[0];
    let mid_end_x_dist = midPoint[0] - endPoint[0];
    
    let start_mid_y_dist = startPoint[1] - midPoint[1];
    let start_end_y_dist = startPoint[1] - endPoint[1];
    let mid_end_y_dist = midPoint[1] - endPoint[1];

    let max_dist_x = Math.max(
      Math.abs(start_mid_x_dist),
      Math.abs(start_end_x_dist),
      Math.abs(mid_end_x_dist)
    );
    let max_dist_y = Math.max(
      Math.abs(start_mid_y_dist),
      Math.abs(start_end_y_dist),
      Math.abs(mid_end_y_dist)
    );

    let voteVertical = 0.0;
    let voteDiagonal = 0.0;
    let voteHorizontal = 0.0;

    let start_end_x_y_dist_ratio = max_dist_y / (max_dist_x + 0.00001);
    if(start_end_x_y_dist_ratio > 1.5) {
      voteVertical += this.options.DISTANCE_VOTE_POWER;
    }
    else if(start_end_x_y_dist_ratio > 0.66) {
      voteDiagonal += this.options.DISTANCE_VOTE_POWER;
    }
    else {
      voteHorizontal += this.options.DISTANCE_VOTE_POWER;
    }

    let start_mid_dist = Math.sqrt(
      start_mid_x_dist * start_mid_x_dist + start_mid_y_dist *start_mid_y_dist
    );
    let start_end_dist = Math.sqrt(
      start_end_x_dist * start_end_x_dist + start_end_y_dist * start_end_y_dist
    );
    let mid_end_dist = Math.sqrt(
      mid_end_x_dist * mid_end_x_dist + mid_end_y_dist * mid_end_y_dist
    );

    let max_dist = Math.max(start_mid_dist, start_end_dist, mid_end_dist);
    let calc_start_point_x = startPoint[0],
        calc_start_point_y = startPoint[1];
    let calc_end_point_x = endPoint[0],
        calc_end_point_y = endPoint[1];

    if(max_dist == start_mid_dist) {
      calc_end_point_x = endPoint[0],
      calc_end_point_y = endPoint[1];
    }
    else if(max_dist == mid_end_dist) {
      calc_start_point_x = midPoint[0],
      calc_start_point_y = midPoint[1];
    }

    let calcStartPoint = [calc_start_point_x, calc_start_point_y];
    let calcEndPoint = [calc_end_point_x, calc_end_point_y];

    let totalAngle = this.getSlopes(calcStartPoint, calcEndPoint);
    let votes = this.angleOrientationAt(totalAngle, this.options.TOTAL_ANGLE_VOTE_POWER);
    voteVertical += votes[0];
    voteDiagonal += votes[1];
    voteHorizontal += votes[2];

    for(let fingerSlope of fingerSlopes) {
      let votes = this.angleOrientationAt(fingerSlope, this.options.SINGLE_ANGLE_VOTE_POWER);
      voteVertical += votes[0];
      voteDiagonal += votes[1];
      voteHorizontal += votes[2];
    }

    // in case of tie, highest preference goes to Vertical,
    // followed by horizontal and then diagonal
    let estimatedDirection;
    if(voteVertical == Math.max(voteVertical, voteDiagonal, voteHorizontal)) {
      estimatedDirection = this.estimateVerticalDirection(
        start_end_y_dist,
        start_mid_y_dist, 
        mid_end_y_dist, max_dist_y
      );
    }
    else if(voteHorizontal == Math.max(voteDiagonal, voteHorizontal)) {
      estimatedDirection = this.estimateHorizontalDirection(
        start_end_x_dist,
        start_mid_x_dist,
        mid_end_x_dist, max_dist_x
      );
    }
    else {
      estimatedDirection = this.estimateDiagonalDirection(
        start_end_y_dist, start_mid_y_dist,
        mid_end_y_dist, max_dist_y,
        start_end_x_dist, start_mid_x_dist,
        mid_end_x_dist, max_dist_x
      );
    }

    return estimatedDirection;
  }

  calculateSlope(point1x, point1y, point2x, point2y) {

    let value = (point1y - point2y) / (point1x - point2x);
    let slope = Math.atan(value) * 180 / Math.PI;

    if(slope <= 0) {
      slope = -slope;
    }
    else if(slope > 0) {
      slope = 180 - slope;
    }

    return slope;
  }
}


  var is_raised_fist = false;
  var is_open_hand = false;
  var is_finger_up = false;
  var is_draw = false;
  var is_gallery_open = false;

  const raisedDescription = new fp.GestureDescription('raised_fist');

  // thumb:
  raisedDescription.addCurl(fp.Finger.Thumb, fp.FingerCurl.HalfCurl, 1.0);

  // index:
  raisedDescription.addCurl(fp.Finger.Index, fp.FingerCurl.FullCurl, 1.0);

  // middle:
  raisedDescription.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);

  // ring:
  raisedDescription.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);

  // pinky:
  raisedDescription.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);


  const openDescription = new fp.GestureDescription('open_hand');

  // thumb:
  openDescription.addCurl(fp.Finger.Thumb, fp.FingerCurl.NoCurl, 1.0);

  // index:
  openDescription.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);

  // middle:
  openDescription.addCurl(fp.Finger.Middle, fp.FingerCurl.NoCurl, 1.0);

  // ring:
  openDescription.addCurl(fp.Finger.Ring, fp.FingerCurl.NoCurl, 1.0);

  // pinky:
  openDescription.addCurl(fp.Finger.Pinky, fp.FingerCurl.NoCurl, 1.0);



  const fingerDescription = new fp.GestureDescription('finger_up');

  // thumb:
  // raisedDescription.addCurl(fp.Finger.Thumb, fp.FingerCurl.FullCurl, 1.0);

  // index:
  fingerDescription.addCurl(fp.Finger.Index, fp.FingerCurl.NoCurl, 1.0);

  // middle:
  fingerDescription.addCurl(fp.Finger.Middle, fp.FingerCurl.FullCurl, 1.0);

  // ring:
  fingerDescription.addCurl(fp.Finger.Ring, fp.FingerCurl.FullCurl, 1.0);

  // pinky:
  fingerDescription.addCurl(fp.Finger.Pinky, fp.FingerCurl.FullCurl, 1.0);


      const knownGestures = [
        fp.Gestures.VictoryGesture,
        fp.Gestures.ThumbsUpGesture,
        raisedDescription,
        fingerDescription,
        openDescription
      ];
      const GE = new fp.GestureEstimator(knownGestures);


      // main estimation loop 
      function estimate_hands(detections, width, height){


        for(let i = 0; i < detections.multiHandLandmarks.length; i++) {

          landmarks = [];
          for(let j = 0; j < detections.multiHandLandmarks[0].length; j++){
            landmarks.push([detections.multiHandLandmarks[0][j].x * width, 
                            detections.multiHandLandmarks[0][j].y * height, 
                            detections.multiHandLandmarks[0][j].z])
          }

          min_score = 8;
          const est = GE.estimate(landmarks, min_score);
          const dic = {};

          const fp_estimator = new FingerPoseEstimator(dic);

          const fp_est = fp_estimator.estimate(landmarks);

          let poseData = [];
          for(let fingerIdx of fp.Finger.all) {
            poseData.push([
              fp.Finger.getName(fingerIdx),
              fp.FingerCurl.getName(fp_est.curls[fingerIdx]),
              fp.FingerDirection.getName(fp_est.directions[fingerIdx])
            ]);
          }
          
          // console.log(poseData);
          // console.log("tried to estimate gestures " + est.gestures.length);

          if(est.gestures.length > 0) {


            // find gesture with highest match score
            let result = est.gestures.reduce((p, c) => { 
              return (p.score > c.score) ? p : c;
            });
            const gestureStrings = {
                  'raised_fist': '✊',
                  'finger_up' : '👆',
                  'open_hand' : '🖐',
            };

            if (result.name=='open_hand') {
                is_open_hand = true;
            }

            else{
              is_open_hand = false;
            }

             if (result.name=='finger_up') {
                is_finger_up = true;
            }

            else{
              is_finger_up = false;
            }

            // console.log(gestureStrings[result.name]);
            // console.log(result.score);
          }


        }

      };




var objToday = new Date(),
  weekday = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'),
  dayOfWeek = weekday[objToday.getDay()],
  domEnder = function() { var a = objToday; if (/1/.test(parseInt((a + "").charAt(0)))) return "th"; a = parseInt((a + "").charAt(1)); return 1 == a ? "st" : 2 == a ? "nd" : 3 == a ? "rd" : "th" }(),
  dayOfMonth = today + ( objToday.getDate() < 10) ? '0' + objToday.getDate() + domEnder : objToday.getDate() + domEnder,
  months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'),
  curMonth = months[objToday.getMonth()],
  curYear = objToday.getFullYear();
  var today = dayOfWeek + " " + dayOfMonth + " of " + curMonth + ", " + curYear;

// document.getElementsByClassName('date')[0].textContent = today;


//colors button
const btn = document.getElementById('btn');
const btn_01 = document.getElementById('btn_01');
const btn_02 = document.getElementById('btn_02');
const btn_03 = document.getElementById('btn_03');
const btn_04 = document.getElementById('btn_04');
const btn_05 = document.getElementById('btn_05');
const btn_06 = document.getElementById('btn_06');
const btn_07 = document.getElementById('btn_07');

var color = "#F26945";

var bkcolor = "#fffff";
var textcolor = "#000";

const info_btn = document.getElementById('info');
info_btn.addEventListener('click', function onClick() {
  bkcolor = "#fffff";
  var $this = $(this); 
  if($this.hasClass('selected')){
    $(".close_img").css("display", "none");
    $("#info").removeClass("selected");
  } 
  else {
    $("#info").addClass("selected");
    $(".close_img").css("display", "block");
  }
});

const gallery_btn = document.getElementById('gallery');
gallery_btn.addEventListener('click', function onClick() {
  var $this = $(this); 
  if($this.hasClass('selected')){
    $("#gallery").removeClass("selected");
    $(".close_gallery").css("display", "none"); 
  } 
  else {
    $("#gallery").addClass("selected");
    $(".close_gallery").css("display", "block");
  }
});

const upload_btn = document.getElementById('uploadButton');
upload_btn.addEventListener('click', function onClick() {
  bkcolor = "#fffff";
  var $this = $(this); 
  if($this.hasClass('selected')){
    $(".close_upload").css("display", "none");
    $("#uploadButton").removeClass("selected");
  } 
  else {
    $("#uploadButton").addClass("selected");
    $(".close_upload").css("display", "block");
  }
});


// let index = 0;
// var colors = ["#F26945", "#FAE80B", "#CF2133", "#0E8142", "#4D3292", "#2D63AF", "#000000", "#81592F"];
// btn.style.borderStyle = colors[index];
// // btn.style.backgroundColor = colors[index];
// btn.style.text = colors[index];

// btn.addEventListener('click', function onClick() {
//   index = index >= colors.length - 1 ? 0 : index + 1;
//   btn.style.backgroundColor = colors[index];
  
// });



// btn.addEventListener('click', function() {
//   color = "#F26945";
//   if(this.style.border === "") {
//     this.style.border = "1px solid #000";
//   }      
//   else {
//     this.style.border = "";
//   }      
// });

// btn.addEventListener('click', function onClick() {
//   color = "#F26945";
//   this.classList.toggle('buttonSelect'); 
// });


window.onload=function(){
    // document.getElementById('btn').focus();
    $("#btn").addClass("color_selected");
    $("#info").removeClass("selected");
}

btn.addEventListener('click', function onClick() {
  color = "#F26945";
  $(".colors_button").removeClass("color_selected")
  $("#btn").addClass("color_selected");  
  last_points = [];
});
  
btn_01.addEventListener('click', function onClick() {
  color = "#FAE80B";
  $(".colors_button").removeClass("color_selected")
  $("#btn_01").addClass("color_selected");  
  last_points = [];
});

btn_02.addEventListener('click', function onClick() {
  color = "#CF2133";
  $(".colors_button").removeClass("color_selected")
  $("#btn_02").addClass("color_selected");  
  last_points = [];
});

btn_03.addEventListener('click', function onClick() {
  color = "#0E8142";
  $(".colors_button").removeClass("color_selected")
  $("#btn_03").addClass("color_selected");   
  last_points = [];
});

btn_04.addEventListener('click', function onClick() {
  color = "#4D3292";
  $(".colors_button").removeClass("color_selected")
  $("#btn_04").addClass("color_selected");   
  last_points = [];
});

btn_05.addEventListener('click', function onClick() {
  color = "#2D63AF";
  $(".colors_button").removeClass("color_selected")
  $("#btn_05").addClass("color_selected");    
  last_points = [];
});

btn_06.addEventListener('click', function onClick() {
  color = "#81592F"; 
  $(".colors_button").removeClass("color_selected")
  $("#btn_06").addClass("color_selected");   
  last_points = [];
});

btn_07.addEventListener('click', function onClick() {
  color = "#000000";
  $(".colors_button").removeClass("color_selected")
  $("#btn_07").addClass("color_selected");   
  last_points = [];
});





//video  
let detections = {};
const videoElement = document.getElementsByClassName('input_video')[0];

function gotHands(results) {
  detections= results;
  // console.log(detections);
}

const hands = new Hands({locateFile: (file) => {
  return `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`;
}});


hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.6,
    minTrackingConfidence: 0.7
  });
  hands.onResults(gotHands);

const camera = new Camera(videoElement, {
    onFrame: async () => {
      await hands.send({image: videoElement});
    },
    width: 320/1.4,
    height: 240/1.4
  });
camera.start();


var px;
var py;
var lastX = 0;
var lastY = 0;
let pts = [];
var myColors = ["#F26945", "#FAE80B", "#CF2133", "#0E8142", "#4D3292"];
let canvas;
var line_count = 0;
var database;
var counter = 0;
var is_waiting = false;
// var drawing = [];
var current_blob;
var last_points = [];
var line_points_counter = 1;
// var num = 12;


let eraseEnable = false;

let sketch = function(p){
  p.setup = function(){
    canvas = p.createCanvas(p.windowWidth,p.windowHeight);
    canvas.parent('canvascontainer');
    // for (var i = 0; i < num; i++) {
    //   points[i] = p.createVector(p.random(p.windowWidth), p.random(p.windowHeight));
    // }

    var uploadButton = p.select('#Submit');
    uploadButton.mousePressed(submitDraw);


    var uploadButton02 = p.select('#uploadButton');
    uploadButton02.mousePressed(uploadDrawing);

    var downloadButton = p.select('#downloadButton');
    downloadButton.mousePressed(downloadCanvas);

    var clearButton = p.select('#clearButton');
    clearButton.mousePressed(clearCanvas);

    p.background(255);

    const firebaseConfig = {
    apiKey: "AIzaSyC1cngA73ni9Oef-37GkDjksdnQJ48VLno",
    authDomain: "handsdrawing-5f3a9.firebaseapp.com",
    databaseURL: "https://handsdrawing-5f3a9-default-rtdb.firebaseio.com",
    projectId: "handsdrawing-5f3a9",
    storageBucket: "handsdrawing-5f3a9.appspot.com",
    messagingSenderId: "210592277963",
    appId: "1:210592277963:web:0809b3deda186aaebfc24e",
    measurementId: "G-2G046QY5BG"
  };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    ref = database.ref('drawing');

    
    ref.on('value', gotData);
  }

  //modals

  $("#gallery").on("click", function() {
        $(".info-modal, .info-text, .save-overlay, .content-overlay, .modal").removeClass("active_overlay");

        $(".g_modal, .gallery-modal, .gallery-content, figcaption, .preview_img").toggleClass("active_overlay");

        $(".drawinglist").toggleClass("active_gallery");

          $(".close_img").css("display", "none");
          $("#info").removeClass("selected");

          $(".close_upload").css("display", "none");
          $("#uploadButton").removeClass("selected");
  });

  $("#info").on("click", function() {
        $(".g_modal, .gallery-modal, .gallery-content, figcaption, .preview_img, .save-overlay, .content-overlay, .modal").removeClass("active_overlay");

        $(".info-modal, .info-text").toggleClass("active_overlay");

        $("#gallery").removeClass("selected");
        $(".close_gallery").css("display", "none");

        $(".close_upload").css("display", "none");
          $("#uploadButton").removeClass("selected"); 
  });
    

  $("#uploadButton").on("click", function() {
    $(".info-modal, .info-text, .g_modal, .gallery-modal, .gallery-content, figcaption, .preview_img").removeClass("active_overlay");
    
    $(".save-overlay, .content-overlay, .modal").toggleClass("active_overlay");

    $(".close_img").css("display", "none");
    $("#info").removeClass("selected");

    $("#gallery").removeClass("selected");
    $(".close_gallery").css("display", "none"); 

   });

  $("#Submit").on("click", function() {
    $(".save-overlay, .content-overlay, .modal").removeClass("active_overlay");
   });

  $(".name").on("click", function() {
    $(".info-modal, .info-text, .g_modal, .gallery-modal, .gallery-content, figcaption, .preview_img, .save-overlay, .content-overlay, .modal").removeClass("active_overlay");
   });
        
  function clearCanvas(){
    p.clear();
    p.background(255);
    last_points = [];
  }

  function downloadCanvas() {
    p.saveCanvas('BacktoKindergarten', 'jpg');
  }

  
  function uploadDrawing(){
    // document.querySelector('#preview').innerHTML = 'loading...';
   

    let html_canvas = document.querySelector("#defaultCanvas0");
    html_canvas.toBlob(function(blob){
        current_blob = blob;
        var objectURL = URL.createObjectURL(current_blob);
        document.querySelector('#preview').innerHTML = '';
        var preview = document.createElement('img');
        document.querySelector('#preview').appendChild(preview);
        preview.src = objectURL;
        preview.width = 800;
        preview.height = 480;
    });
  }

  function submitDraw(){
      var storageRef = firebase.storage().ref();
      var element = document.getElementById("name_input");
      var text = element.value;
      var file_ref = storageRef.child('images/' + Math.floor(Math.random() * 1000));
      var uploadTask = file_ref.put(current_blob).then((snapshot) => {
        var url = file_ref.getDownloadURL().then((url) => {
        // Do something with the URL ...
        var ref = database.ref('drawing');
        var data = {
          name: text,
          url: url
        }
        var results = ref.push(data);
        // document.querySelector('#preview').innerHTML = '';
        // var preview = document.createElement('span', url);
        // document.querySelector('#preview').appendChild(preview);
        // var img = document.createElement('img');
        // img.src = url;
        // img.width = p.windowWidth/3.5;
        // img.height = p.windowHeight/3.5;
        // preview.appendChild(img);
        // console.log(url);
        }

      );
    });
  }


   function gotData(data){

    if (data == null) {
      return;
    }

    var data = data.val();

    if (data == null) {
      return;
    }

    var keys = Object.keys(data);
    ref = database.ref('drawing');
    document.querySelector('main').innerHTML = '';
    for (var i = 0; i< keys.length; i++) {
      // ref.child(keys[i]).remove();
      var key = keys[i];
      url = data[key].url;
      name = data[key].name;
      var li = document.createElement('div', url);
      li.classList.add("li-draw");
      document.querySelector('div.drawinglist').appendChild(li);
      var img = document.createElement('img');
      img.classList.add("preview_img");
      var label = document.createElement('figcaption');
      label.innerHTML = name;
      img.src = url;
      img.width = 395;
      img.height = 237;
      li.appendChild(img);
      li.appendChild(label);
    }
   }

  function showDrawing(){
    var key = this.html();
    var ref = database.ref('drawing/' + key);
    ref.on('value', oneDrawing, errData);

    function oneDrawing(data){
      // var dbdrawing = data.val();
      // drawing = dbdrawing.drawing;
    }
  }


  p.draw = function(){
    var is_open = $( ".save-overlay" ).hasClass( "active_overlay" )
    || $( ".gallery-modal" ).hasClass( "active_overlay" )
    || $( ".info-modal" ).hasClass( "active_overlay" );

    if (!is_open) {
    
    if (detections != undefined) {
      if (detections.multiHandLandmarks != undefined) {
        if (is_draw) {
          p.drawHands();
        }
        if(detections.multiHandLandmarks.length > 0){
          estimate_hands(detections, p.width, p.height);  
        }
        if (is_open_hand) {
          is_draw = false;
          last_points = [];
          line_count = 0;
        }
        if (is_finger_up) {
          if (is_draw==false) {
            is_waiting=true;
            clearTimeout(timeIt);
            setTimeout(timeIt, 2000);
          }
          is_draw = true;
          $( "#on_start" ).hide();
        }
      }
    } 
         
  }

}

  function timeIt(){
    is_waiting=false;
    $( "#hand_pointer" ).hide();
  }

// draw lines

p.drawHands = function(){
  p.stroke(color);
  p.strokeWeight(6);
  p.strokeJoin(p.ROUND);
  p.strokeCap(p.ROUND);


  for (var i =0; i<detections.multiHandLandmarks.length; i++) {
    for (var j =0; j<detections.multiHandLandmarks[i].length; j++) {
      
      let x = (1- detections.multiHandLandmarks[i][j].x) * p.width;
      let y = detections.multiHandLandmarks[i][j].y * p.height;

      if(lastX==0 && lastY==0){
        lastX = x;
        lastY = y;
      }
      
      line_points_counter++;
      num_line_points = Math.min(line_points_counter, 8);

      if(j==8){
        let d = p.dist(lastX, lastY, x, y);

        // const pointer = document.getElementsByClassName("hand_pointer");
        if (is_waiting==true) {
          $( "#hand_pointer" ).show();
          var div_element = document.getElementById('hand_pointer');
          div_element.style.top = String(y) + "px";
          div_element.style.left = String(x) + "px";
          div_element.style.backgroundColor = color;
          return;
        }

        if (true) {
          line_count++;
          if(line_count>2){
            // p.line(lastX, lastY, x, y);
            last_points.push([x,y]);
            p.beginShape();
            p.noFill();
            start_index = Math.max(0,last_points.length - num_line_points);
            for (var p_index = start_index; p_index < last_points.length; p_index++) {
              p.curveVertex(last_points[p_index][0], last_points[p_index][1]);
            }
            p.endShape();          
            // drawing.push({x1:lastX, y1:lastY, x2: x, y2:y, color: color}); 
        }
          lastX = x;
          lastY = y;
        }

        else{
          lastX = 0;
          lastY = 0;
          // console.log(d);
        }    

      } 

      }
    }
  }
}
let myp5 = new p5(sketch);

}

</script>